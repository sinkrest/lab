<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Pipeline ‚Äî The PD Strategy Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: #0b1628; color: #e4eaf4; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }

        .back { position: absolute; top: 1.2rem; left: 1.2rem; color: #27c0e7; text-decoration: none; font-size: .9rem; z-index: 10; }

        .header {
            background: linear-gradient(135deg, #0b1628 0%, #132744 50%, #1a3a6b 100%);
            width: 100%;
            text-align: center;
            padding: 2.2rem 1rem 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: -40%;
            right: -10%;
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, rgba(39,192,231,0.08) 0%, transparent 70%);
            border-radius: 50%;
        }
        .badge {
            display: inline-block;
            background: rgba(39,192,231,0.15);
            border: 1px solid rgba(39,192,231,0.3);
            color: #27c0e7;
            font-size: .75rem;
            font-weight: 600;
            letter-spacing: .08em;
            text-transform: uppercase;
            padding: .35rem .9rem;
            border-radius: 20px;
            margin-bottom: .7rem;
        }
        h1 { font-size: 1.8rem; font-weight: 800; color: #fff; margin-bottom: .2rem; }
        h1 span { color: #27c0e7; }
        .header .tagline { color: #7a92b5; font-size: .88rem; margin-top: .3rem; }

        /* Dashboard */
        .dashboard {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding: 1rem 1rem;
            background: rgba(255,255,255,0.02);
            border-bottom: 1px solid rgba(255,255,255,0.06);
            width: 100%;
            flex-wrap: wrap;
        }
        .dash-card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.07);
            border-radius: 10px;
            padding: .6rem 1.1rem;
            text-align: center;
            min-width: 90px;
        }
        .dash-card .label { font-size: .65rem; color: #5d7da3; text-transform: uppercase; letter-spacing: .06em; }
        .dash-card .value { font-size: 1.2rem; font-weight: 800; color: #27c0e7; }
        .dash-card .value.green { color: #2ecc71; }
        .dash-card .value.amber { color: #f39c12; }
        .dash-card .value.red { color: #e74c3c; }

        /* Pipeline stage bar */
        .pipeline-bar {
            display: flex;
            width: 100%;
            max-width: 500px;
            margin: .8rem auto 0;
            gap: 2px;
            border-radius: 6px;
            overflow: hidden;
            height: 6px;
        }
        .pipeline-seg { flex: 1; transition: opacity .3s; }
        .pipeline-seg.active { opacity: 1; }
        .pipeline-seg.inactive { opacity: 0.2; }

        /* Stage label */
        .stage-label {
            text-align: center;
            padding: .5rem;
            font-size: .8rem;
            font-weight: 600;
            color: #94a7c8;
        }
        .stage-label strong { color: #27c0e7; }

        .game-area {
            position: relative;
            display: inline-block;
            margin: .8rem 0;
        }
        canvas {
            border: 2px solid rgba(39,192,231,0.3);
            border-radius: 12px;
            background: #0d1f35;
            display: block;
            box-shadow: 0 4px 30px rgba(39,192,231,0.08);
        }

        .controls { margin-top: 1rem; display: grid; grid-template-areas: ". up ." "left down right"; gap: .5rem; }
        .controls button {
            width: 56px; height: 56px; font-size: 1.4rem;
            border: 1px solid rgba(39,192,231,0.25);
            background: rgba(255,255,255,0.05);
            color: #27c0e7;
            border-radius: 12px;
            cursor: pointer;
            transition: background .15s, transform .1s;
            backdrop-filter: blur(4px);
        }
        .controls button:hover { background: rgba(39,192,231,0.15); }
        .controls button:active { transform: scale(0.92); background: rgba(39,192,231,0.25); }
        .btn-up { grid-area: up; }
        .btn-down { grid-area: down; }
        .btn-left { grid-area: left; }
        .btn-right { grid-area: right; }

        /* Event log */
        .event-log {
            max-width: 460px;
            width: 100%;
            margin: 1rem auto;
            padding: 0 1rem;
        }
        .event-log h3 { font-size: .8rem; color: #5d7da3; text-transform: uppercase; letter-spacing: .06em; margin-bottom: .5rem; }
        .log-entries {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 10px;
            padding: .6rem .8rem;
            max-height: 100px;
            overflow-y: auto;
            font-size: .8rem;
            color: #7a92b5;
            line-height: 1.6;
        }
        .log-entries .entry { border-bottom: 1px solid rgba(255,255,255,0.03); padding: .2rem 0; }
        .log-entries .entry:last-child { border: none; }
        .log-entries .entry span { color: #27c0e7; font-weight: 600; }

        .info { margin-top: .8rem; color: #4a6080; font-size: .82rem; text-align: center; padding-bottom: 2rem; }
        .info a { color: #27c0e7; text-decoration: none; }

        .overlay {
            position: absolute;
            top: 0; left: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(11,22,40,0.92);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
        }
        .overlay h2 { font-size: 1.6rem; margin-bottom: .5rem; color: #fff; }
        .overlay p { color: #94a7c8; font-size: .95rem; line-height: 1.5; max-width: 320px; }
        .overlay .stats-row { display: flex; gap: 1.5rem; margin: 1rem 0; }
        .overlay .mini-stat { text-align: center; }
        .overlay .mini-stat .num { font-size: 1.3rem; font-weight: 800; color: #27c0e7; }
        .overlay .mini-stat .lbl { font-size: .7rem; color: #5d7da3; text-transform: uppercase; }
        .overlay button {
            margin-top: .8rem;
            padding: .75rem 2rem;
            background: linear-gradient(90deg, #27c0e7, #1e488f);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform .15s, box-shadow .2s;
            font-family: 'Inter', sans-serif;
        }
        .overlay button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(39,192,231,0.3);
        }
        .overlay .hint { font-size: .78rem; color: #4a6080; margin-top: .6rem; }

        /* Floating pickup text */
        .float-text {
            position: absolute;
            font-size: .75rem;
            font-weight: 700;
            pointer-events: none;
            animation: floatUp 1.2s ease-out forwards;
            z-index: 5;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-40px); }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back">‚Üê All Projects</a>

    <div class="header">
        <div class="badge">üè≠ Product Development Game</div>
        <h1>Product <span>Pipeline</span></h1>
        <p class="tagline">Build your product pipeline. Collect milestones. Avoid scope creep.</p>
    </div>

    <div class="dashboard">
        <div class="dash-card"><div class="label">Products</div><div class="value" id="score">0</div></div>
        <div class="dash-card"><div class="label">Best Run</div><div class="value" id="best">0</div></div>
        <div class="dash-card"><div class="label">Stage</div><div class="value" id="stage">Concept</div></div>
        <div class="dash-card"><div class="label">Velocity</div><div class="value" id="speed">1.0x</div></div>
        <div class="dash-card"><div class="label">Pipeline Health</div><div class="value green" id="health">‚óè‚óè‚óè</div></div>
    </div>

    <div class="pipeline-bar" id="pipelineBar"></div>
    <div class="stage-label" id="stageLabel">Stage: <strong>Concept</strong> ‚Üí Collect milestones to advance</div>

    <div class="game-area">
        <canvas id="game" width="400" height="400"></canvas>
        <div class="overlay" id="overlay" style="width:400px;height:400px;">
            <h2>üè≠ Product Pipeline</h2>
            <p>You're a Product Development Manager building your pipeline. Collect milestones (üí°üìêüîß‚úÖüöÄ) to advance through stages. Avoid the walls ‚Äî that's scope creep!</p>
            <button onclick="startGame()">Launch Pipeline</button>
            <div class="hint">Arrow keys / WASD / touch buttons</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-up" onclick="changeDir(0,-1)">‚ñ≤</button>
        <button class="btn-left" onclick="changeDir(-1,0)">‚óÄ</button>
        <button class="btn-down" onclick="changeDir(0,1)">‚ñº</button>
        <button class="btn-right" onclick="changeDir(1,0)">‚ñ∂</button>
    </div>

    <div class="event-log">
        <h3>üìã Development Log</h3>
        <div class="log-entries" id="logEntries">
            <div class="entry"><span>[System]</span> Pipeline initialized. Awaiting launch...</div>
        </div>
    </div>

    <div class="info">Arrow keys or WASD to move ¬∑ Mobile: use buttons ¬∑ <a href="index.html">‚Üê All Projects</a></div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const SIZE = 20, COLS = 20, ROWS = 20;

        // PD themed stages and milestones
        const stages = [
            { name: 'Concept',      color: '#3498db', icon: 'üí°', milestones: ['Idea validated','VOC gathered','Business case drafted'] },
            { name: 'Feasibility',   color: '#9b59b6', icon: 'üîç', milestones: ['Tech feasibility confirmed','Risk assessment done','Budget approved'] },
            { name: 'Design',        color: '#27c0e7', icon: 'üìê', milestones: ['CAD complete','DFMEA done','BOM finalized'] },
            { name: 'Prototype',     color: '#2ecc71', icon: 'üîß', milestones: ['Prototype built','DVT passed','Supplier qualified'] },
            { name: 'Validation',    color: '#f39c12', icon: '‚úÖ', milestones: ['PVT passed','Regulatory submitted','Quality plan set'] },
            { name: 'Launch',        color: '#e74c3c', icon: 'üöÄ', milestones: ['Tooling ready','Production ramped','Product launched!'] },
        ];

        const pickupMessages = [
            'Milestone achieved!', 'Gate passed!', 'Stakeholder approved!', 'Budget secured!',
            'Patent filed!', 'Prototype validated!', 'Supplier locked in!', 'QA signed off!',
            'Customer feedback positive!', 'Design review passed!', 'Risk mitigated!',
            'Team aligned!', 'Spec frozen!', 'Tooling ordered!', 'Ship it!'
        ];

        const obstacleNames = [
            'Scope creep!', 'Budget cut!', 'Supplier delay!', 'Regulatory block!',
            'Design flaw!', 'Market shift!', 'Resource conflict!', 'Timeline slip!'
        ];

        let snake, dir, nextDir, food, score, best = 0, loop, speed, baseSpeed;
        let currentStage, stageProgress, totalCollected, floats = [], obstacles = [];
        let obstacleTimer;

        function startGame() {
            document.getElementById('overlay').style.display = 'none';
            snake = [{x:10,y:10}];
            dir = {x:1,y:0}; nextDir = {x:1,y:0};
            score = 0; baseSpeed = 130; speed = baseSpeed;
            currentStage = 0; stageProgress = 0; totalCollected = 0;
            floats = []; obstacles = [];
            document.getElementById('score').textContent = score;
            document.getElementById('speed').textContent = '1.0x';
            document.getElementById('logEntries').innerHTML = '<div class="entry"><span>[Pipeline]</span> New product development cycle started!</div>';
            updateStageUI();
            updateHealth(3);
            placeFood();
            if(loop) clearInterval(loop);
            if(obstacleTimer) clearInterval(obstacleTimer);
            loop = setInterval(tick, speed);
            obstacleTimer = setInterval(spawnObstacle, 8000);
        }

        function placeFood() {
            do { food = {x: Math.floor(Math.random()*COLS), y: Math.floor(Math.random()*ROWS)}; }
            while(snake.some(s => s.x === food.x && s.y === food.y) || obstacles.some(o => o.x === food.x && o.y === food.y));
        }

        function spawnObstacle() {
            if(obstacles.length >= 6) return;
            let o;
            do { o = {x: Math.floor(Math.random()*COLS), y: Math.floor(Math.random()*ROWS), life: 15}; }
            while(snake.some(s => s.x === o.x && s.y === o.y) || (food.x === o.x && food.y === o.y));
            obstacles.push(o);
        }

        function addLog(msg) {
            const el = document.getElementById('logEntries');
            const stage = stages[currentStage];
            el.innerHTML = `<div class="entry"><span>[${stage.name}]</span> ${msg}</div>` + el.innerHTML;
            if(el.children.length > 15) el.removeChild(el.lastChild);
        }

        function updateStageUI() {
            const stage = stages[currentStage];
            document.getElementById('stage').textContent = stage.icon + ' ' + stage.name;
            document.getElementById('stageLabel').innerHTML = `Stage: <strong>${stage.name}</strong> ‚Äî ${stage.milestones[Math.min(stageProgress, stage.milestones.length-1)]}`;

            // Pipeline bar
            let html = '';
            stages.forEach((s, i) => {
                html += `<div class="pipeline-seg ${i <= currentStage ? 'active' : 'inactive'}" style="background:${s.color}"></div>`;
            });
            document.getElementById('pipelineBar').innerHTML = html;
        }

        function updateHealth(level) {
            const el = document.getElementById('health');
            if(level >= 3) { el.textContent = '‚óè‚óè‚óè'; el.className = 'value green'; }
            else if(level >= 2) { el.textContent = '‚óè‚óè‚óã'; el.className = 'value amber'; }
            else { el.textContent = '‚óè‚óã‚óã'; el.className = 'value red'; }
        }

        function tick() {
            dir = nextDir;
            const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

            // Wall collision = scope creep
            if(head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS || snake.some(s => s.x === head.x && s.y === head.y)) return gameOver('scope creep');

            // Obstacle collision
            if(obstacles.some(o => o.x === head.x && o.y === head.y)) return gameOver('obstacle');

            snake.unshift(head);

            if(head.x === food.x && head.y === food.y) {
                score++;
                totalCollected++;
                stageProgress++;
                document.getElementById('score').textContent = score;
                if(score > best) { best = score; document.getElementById('best').textContent = best; }

                // Stage advancement
                if(stageProgress >= 3 && currentStage < stages.length - 1) {
                    currentStage++;
                    stageProgress = 0;
                    addLog(`üéâ Advanced to ${stages[currentStage].name} stage!`);
                } else {
                    const stage = stages[currentStage];
                    const milestone = stage.milestones[Math.min(stageProgress - 1, stage.milestones.length - 1)];
                    addLog(milestone);
                }
                updateStageUI();

                // Float text
                const msg = pickupMessages[Math.floor(Math.random() * pickupMessages.length)];
                floats.push({ x: head.x * SIZE, y: head.y * SIZE, text: stages[currentStage].icon + ' ' + msg, life: 30, color: stages[currentStage].color });

                placeFood();
                if(speed > 60) {
                    speed -= 2;
                    clearInterval(loop);
                    loop = setInterval(tick, speed);
                    document.getElementById('speed').textContent = (baseSpeed / speed).toFixed(1) + 'x';
                }

                // Health
                const h = snake.length < 8 ? 3 : snake.length < 15 ? 2 : 1;
                updateHealth(h);
            } else { snake.pop(); }

            // Decay obstacles
            obstacles = obstacles.filter(o => { o.life--; return o.life > 0; });

            // Decay floats
            floats = floats.filter(f => { f.life--; return f.life > 0; });

            draw();
        }

        function draw() {
            ctx.fillStyle = '#0d1f35'; ctx.fillRect(0,0,canvas.width,canvas.height);

            // Subtle grid
            ctx.fillStyle = 'rgba(39,192,231,0.03)';
            for(let i=0;i<COLS;i++) for(let j=0;j<ROWS;j++) {
                ctx.beginPath(); ctx.arc(i*SIZE+SIZE/2, j*SIZE+SIZE/2, 1, 0, Math.PI*2); ctx.fill();
            }

            // Obstacles (scope creep blocks)
            obstacles.forEach(o => {
                const alpha = Math.min(1, o.life / 5);
                ctx.fillStyle = `rgba(231,76,60,${alpha * 0.3})`;
                ctx.fillRect(o.x*SIZE, o.y*SIZE, SIZE, SIZE);
                ctx.strokeStyle = `rgba(231,76,60,${alpha * 0.6})`;
                ctx.lineWidth = 2;
                ctx.strokeRect(o.x*SIZE+2, o.y*SIZE+2, SIZE-4, SIZE-4);
                // X mark
                ctx.strokeStyle = `rgba(231,76,60,${alpha * 0.8})`;
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(o.x*SIZE+5, o.y*SIZE+5); ctx.lineTo(o.x*SIZE+SIZE-5, o.y*SIZE+SIZE-5);
                ctx.moveTo(o.x*SIZE+SIZE-5, o.y*SIZE+5); ctx.lineTo(o.x*SIZE+5, o.y*SIZE+SIZE-5);
                ctx.stroke();
            });

            // Food glow
            const stage = stages[currentStage];
            const grd = ctx.createRadialGradient(food.x*SIZE+SIZE/2, food.y*SIZE+SIZE/2, 2, food.x*SIZE+SIZE/2, food.y*SIZE+SIZE/2, SIZE*1.2);
            grd.addColorStop(0, stage.color + '44');
            grd.addColorStop(1, 'transparent');
            ctx.fillStyle = grd;
            ctx.fillRect(food.x*SIZE-SIZE, food.y*SIZE-SIZE, SIZE*3, SIZE*3);

            // Food (milestone)
            ctx.fillStyle = stage.color;
            ctx.beginPath(); ctx.roundRect(food.x*SIZE+2, food.y*SIZE+2, SIZE-4, SIZE-4, 4); ctx.fill();
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(stage.icon, food.x*SIZE+SIZE/2, food.y*SIZE+SIZE/2);

            // Snake (pipeline)
            snake.forEach((s,i) => {
                const segStage = Math.min(Math.floor(i / 3), stages.length - 1);
                const alpha = Math.max(0.25, 1 - i * 0.025);
                if(i === 0) {
                    ctx.fillStyle = '#27c0e7';
                    ctx.shadowColor = '#27c0e7';
                    ctx.shadowBlur = 14;
                } else {
                    ctx.fillStyle = stages[Math.min(currentStage, stages.length-1)].color + Math.round(alpha*255).toString(16).padStart(2,'0');
                    ctx.shadowBlur = 0;
                }
                ctx.beginPath(); ctx.roundRect(s.x*SIZE+1, s.y*SIZE+1, SIZE-2, SIZE-2, 5); ctx.fill();
                ctx.shadowBlur = 0;
            });

            // Head icon
            if(snake.length > 0) {
                ctx.font = '11px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('üè≠', snake[0].x*SIZE+SIZE/2, snake[0].y*SIZE+SIZE/2);
            }

            // Float texts
            floats.forEach(f => {
                const alpha = f.life / 30;
                ctx.fillStyle = f.color + Math.round(alpha*255).toString(16).padStart(2,'0');
                ctx.font = `700 11px Inter`;
                ctx.textAlign = 'center';
                ctx.fillText(f.text, f.x + SIZE/2, f.y - (30 - f.life) * 1.5);
            });
        }

        function gameOver(reason) {
            clearInterval(loop); loop = null;
            clearInterval(obstacleTimer); obstacleTimer = null;

            const failMsg = reason === 'obstacle'
                ? obstacleNames[Math.floor(Math.random() * obstacleNames.length)]
                : 'Scope creep derailed the project!';

            addLog('‚ùå ' + failMsg);

            const ov = document.getElementById('overlay');
            const stageReached = stages[currentStage].name;
            document.getElementById('overlay').querySelector('h2').textContent = 'üìâ Project Cancelled';
            document.getElementById('overlay').querySelector('p').innerHTML =
                `<strong>${failMsg}</strong><br><br>` +
                `<div class="stats-row">` +
                `<div class="mini-stat"><div class="num">${score}</div><div class="lbl">Products</div></div>` +
                `<div class="mini-stat"><div class="num">${stageReached}</div><div class="lbl">Stage Reached</div></div>` +
                `<div class="mini-stat"><div class="num">${(baseSpeed/speed).toFixed(1)}x</div><div class="lbl">Final Velocity</div></div>` +
                `</div>` +
                (score === best && score > 0 ? 'üèÜ New personal best!' : '');

            ov.querySelector('button').textContent = 'New Development Cycle';
            ov.querySelector('.hint').textContent = score >= 15 ? 'üåü Outstanding pipeline management!' : score >= 10 ? 'üëè Great run ‚Äî VP material!' : score >= 5 ? 'üìà Solid start, iterate and improve' : 'üí™ Every failed project is a lesson';
            ov.style.display = 'flex';
        }

        function changeDir(x,y) {
            if(dir && dir.x === -x && dir.y === -y) return;
            nextDir = {x,y};
            if(!loop) startGame();
        }

        document.addEventListener('keydown', e => {
            const map = {ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0],w:[0,-1],s:[0,1],a:[-1,0],d:[1,0]};
            const d = map[e.key]; if(d) { e.preventDefault(); changeDir(d[0],d[1]); }
        });

        // Touch swipe
        let touchStart = null;
        canvas.addEventListener('touchstart', e => { touchStart = {x: e.touches[0].clientX, y: e.touches[0].clientY}; });
        canvas.addEventListener('touchend', e => {
            if(!touchStart) return;
            const dx = e.changedTouches[0].clientX - touchStart.x;
            const dy = e.changedTouches[0].clientY - touchStart.y;
            if(Math.abs(dx) > Math.abs(dy)) changeDir(dx > 0 ? 1 : -1, 0);
            else changeDir(0, dy > 0 ? 1 : -1);
            touchStart = null;
        });

        // Initial
        document.getElementById('overlay').style.display = 'flex';
        ctx.fillStyle = '#0d1f35'; ctx.fillRect(0,0,400,400);

        // Render pipeline bar initially
        let html = '';
        stages.forEach((s, i) => {
            html += `<div class="pipeline-seg inactive" style="background:${s.color}"></div>`;
        });
        document.getElementById('pipelineBar').innerHTML = html;
    </script>
</body>
</html>
